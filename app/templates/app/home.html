{% extends 'app/base.html' %}
{% load static %}
{% block title %}Home{% endblock title %}

{% block banner_slider %}
<div id="carouselExampleControls" class="carousel slide" data-bs-ride="carousel">
    <div class="carousel-inner">
        <div class="carousel-item active">
            <img src="{% static 'app/images/banner/b2.png' %}" class="d-block w-100 img-fluid" style="height: 600px; object-fit: cover; border-radius: 20px;" alt="Banner 1">
        </div>
        <div class="carousel-item">
            <img src="{% static 'app/images/banner/b2.png' %}" class="d-block w-100 img-fluid" style="height: 600px; object-fit: cover; border-radius: 20px;" alt="Banner 2">
        </div>
    </div>
</div>
{% endblock banner_slider %}

{% block livesale %}
<div class="container text-center p-5 text-white bg-danger border-bottom shadow">
    <h1 style="font-size: 3rem; font-weight: bold;">SALE IS LIVE NOW</h1>
    <p style="font-size: 1.5rem;">5% Instant Discount on Axis Bank Credit and Debit Card</p>
    <small style="font-size: 1.2rem;">Terms and Conditions Applied</small>
</div>
{% endblock livesale %}

{% block main-content %}
<div class="m-5">
    <h2 style="font-size: 2.5rem; font-weight: bold;">Shopz Bottom Wear</h2>
    <div class="owl-carousel" id="slider1">
        {% for b in bottomwears %}
        <a href="{% url 'product-detail' b.id %}" class="btn">
            <div class="item">
                <img src="{{ b.product_image.url }}" class="img-fluid" style="height: 400px; width: 100%; object-fit: cover;">
                <span style="font-size: 1.8rem; font-weight: bold;">{{ b.title }}</span><br>
                <span style="font-size: 2rem; color: red;">Rs. {{ b.discounted_price }}</span>
            </div>
        </a>
        {% endfor %}
    </div>
</div>

<!-- Chatbot Integration -->
<div class="chatbot-icon" onclick="toggleChatbot()">
    <img src="{% static 'app/images/chatbot_icon.jpg' %}" class="img-fluid chatbot-icon-img">
</div>
<div class="chatbot-container" id="chatbot-container">
    <div class="chat-header">Shopz Chatbot <span class="close-btn" onclick="toggleChatbot()">Ã—</span></div>
    <div class="chat-body" id="chat-body"><p><b>Bot:</b> Hi! How can I assist you today?</p></div>
    <div class="chat-input">
        <input type="text" id="user-message" placeholder="Type your message...">
        <button onclick="sendMessage()">Send</button>
    </div>
</div>

<style>
    .chatbot-icon {
        position: fixed;
        bottom: 30px;
        right: 30px;
        cursor: pointer;
        background: linear-gradient(135deg, #007bff, #00d4ff);
        padding: 10px;
        border-radius: 50%;
        box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.3);
        transition: transform 0.2s;
    }
    .chatbot-icon:hover {
        transform: scale(1.1);
    }
    .chatbot-icon-img {
        width: 100px;
        height: 100px;
        border-radius: 50%;
    }
    .chatbot-container {
        display: none;
        position: fixed;
        bottom: 80px;
        right: 30px;
        width: 500px;
        height: 580px;
        background: white;
        border-radius: 20px;
        box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.3);
        padding: 20px;
        font-size: 1.5rem;
    }
    .chat-header {
        background: #007bff;
        color: white;
        padding: 15px;
        font-size: 2rem;
        text-align: center;
        border-radius: 15px 15px 0 0;
    }
    .chat-body {
        height: 500px;
        overflow-y: auto;
        padding: 15px;
        background: #f9f9f9;
    }
    .chat-input {
        display: flex;
        padding: 10px;
        border-top: 1px solid #ddd;
    }
    .chat-input input {
        flex: 1;
        padding: 15px;
        font-size: 1.5rem;
        border-radius: 10px;
    }
    .chat-input button {
        background: #007bff;
        color: white;
        border: none;
        padding: 15px;
        font-size: 1.5rem;
        cursor: pointer;
        border-radius: 10px;
        margin-left: 10px;
    }
    .chat-input button:hover {
        background: #0056b3;
    }
    .close-btn {
        position: absolute;
        top: 10px;
        right: 20px;
        cursor: pointer;
        font-size: 2rem;
        color: white;
    }
</style>

<script>
    function toggleChatbot() {
        let chatbot = document.getElementById("chatbot-container");
        chatbot.style.display = chatbot.style.display === "none" ? "block" : "none";
    }
    function sendMessage() {
        let userMessage = document.getElementById("user-message").value;
        let chatBody = document.getElementById("chat-body");
        if (userMessage.trim() === "") return;
        chatBody.innerHTML += `<p><b>You:</b> ${userMessage}</p>`;
        document.getElementById("user-message").value = "";
        fetch("/chatbot/chat/", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ "message": userMessage })
        })
        .then(response => response.json())
        .then(data => {
            chatBody.innerHTML += `<p><b>Bot:</b> ${data.response}</p>`;
            chatBody.scrollTop = chatBody.scrollHeight;
        })
        .catch(error => {
            chatBody.innerHTML += `<p><b>Bot:</b> Sorry, an error occurred.</p>`;
        });
    }
</script>
{% endblock main-content %}
